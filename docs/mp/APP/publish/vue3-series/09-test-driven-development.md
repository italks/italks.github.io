# æµ‹è¯•é©±åŠ¨å¼€å‘ï¼šVitest ä¸ Cypress å®æˆ˜ (Vue 3 å…¨æ™¯æ”»ç•¥ - 09)

> **æ‘˜è¦**ï¼šä¸æ•¢é‡æ„ï¼Ÿå› ä¸ºæ²¡æœ‰æµ‹è¯•ï¼æœ¬æ–‡å°†å¸¦ä½ å»ºç«‹å‰ç«¯æµ‹è¯•é‡‘å­—å¡”ï¼šåˆ©ç”¨ Vitest è¿›è¡Œæé€Ÿå•å…ƒæµ‹è¯•ä¸ Composable æµ‹è¯•ï¼Œä½¿ç”¨ Vue Test Utils éªŒè¯ç»„ä»¶äº¤äº’é€»è¾‘ï¼Œä»¥åŠé€šè¿‡ Cypress è¿›è¡Œç«¯åˆ°ç«¯ï¼ˆE2Eï¼‰æµç¨‹æµ‹è¯•ã€‚æŒæ¡ TDD æ€ç»´ï¼Œè®©è‡ªåŠ¨åŒ–æµ‹è¯•æˆä¸ºä½ ä»£ç è´¨é‡çš„åšå®åç›¾ï¼Œå‘Šåˆ«â€œæ”¹ä¸€å¤„å´©ä¸€ç‰‡â€çš„ææƒ§ã€‚

## å¼•è¨€ï¼šä¸æ•¢é‡æ„çš„ææƒ§

ä½ æ˜¯å¦æœ‰è¿‡è¿™æ ·çš„ç»å†ï¼Ÿ
> æ¥æ‰‹äº†ä¸€ä¸ªè€é¡¹ç›®ï¼Œæƒ³ä¼˜åŒ–ä¸€æ®µé€»è¾‘ï¼Œä½†åˆå®³æ€•æ”¹åäº†æŸä¸ªéšè—çš„åŠŸèƒ½ç‚¹ã€‚
> æ¯æ¬¡å‘ç‰ˆå‰éƒ½è¦æ‰‹åŠ¨ç‚¹ä¸€éæ‰€æœ‰æµç¨‹ï¼Œç”Ÿæ€•æ¼æµ‹äº†ä¸€ä¸ªæŒ‰é’®ã€‚

è¿™å°±æ˜¯ç¼ºä¹è‡ªåŠ¨åŒ–æµ‹è¯•å¸¦æ¥çš„ææƒ§ã€‚åœ¨ Vue 3 é¡¹ç›®ä¸­ï¼Œå¾—ç›Šäº Vite çš„æé€Ÿæ„å»ºï¼Œæˆ‘ä»¬æ‹¥æœ‰äº†æ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½æ›´å¥½çš„æµ‹è¯•ä½“éªŒã€‚

æœ¬æ–‡å°†å¸¦ä½ å»ºç«‹å‰ç«¯æµ‹è¯•é‡‘å­—å¡”ï¼š**å•å…ƒæµ‹è¯• (Unit Test)**ã€**ç»„ä»¶æµ‹è¯• (Component Test)** å’Œ **ç«¯åˆ°ç«¯æµ‹è¯• (E2E Test)**ã€‚

## 1. å•å…ƒæµ‹è¯•ï¼šVitest çš„æé€Ÿä½“éªŒ

Vitest æ˜¯åŸºäº Vite çš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œå®ƒä¸ä»…å¿«ï¼ˆåˆ©ç”¨äº† Vite çš„è½¬æ¢èƒ½åŠ›ï¼‰ï¼Œè€Œä¸” API ä¸ Jest é«˜åº¦å…¼å®¹ã€‚

### 1.1 æµ‹è¯•çº¯é€»è¾‘å‡½æ•°

å¯¹äºæ²¡æœ‰ä»»ä½• UI ä¾èµ–çš„å·¥å…·å‡½æ•°ï¼ˆå¦‚æ—¥æœŸæ ¼å¼åŒ–ã€æ•°æ®è®¡ç®—ï¼‰ï¼Œå•å…ƒæµ‹è¯•æ˜¯æœ€å®¹æ˜“ä¸Šæ‰‹çš„ã€‚

```javascript
// utils/sum.js
export function sum(a, b) {
  return a + b
}

// utils/sum.test.js
import { expect, test } from 'vitest'
import { sum } from './sum'

test('adds 1 + 2 to equal 3', () => {
  expect(sum(1, 2)).toBe(3)
})
```

è¿è¡Œ `npm run test`ï¼Œä½ ä¼šæƒŠè®¶äºå®ƒçš„å¯åŠ¨é€Ÿåº¦ã€‚

### 1.2 æµ‹è¯• Composables

Composables æœ¬è´¨ä¸Šä¹Ÿæ˜¯å‡½æ•°ï¼Œä½†å®ƒå¯èƒ½åŒ…å«å“åº”å¼çŠ¶æ€ã€‚

```javascript
// composables/useCounter.js
import { ref } from 'vue'

export function useCounter() {
  const count = ref(0)
  const increment = () => count.value++
  return { count, increment }
}

// composables/useCounter.test.js
import { useCounter } from './useCounter'

test('increment counter', () => {
  const { count, increment } = useCounter()
  
  expect(count.value).toBe(0)
  increment()
  expect(count.value).toBe(1)
})
```

## 2. ç»„ä»¶æµ‹è¯•ï¼š@vue/test-utils

æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æµ‹è¯•ç»„ä»¶çš„è¡Œä¸ºï¼šç‚¹å‡»æŒ‰é’®åæ˜¯å¦è§¦å‘äº†äº‹ä»¶ï¼Ÿè¾“å…¥æ¡†å˜åŒ–åæ˜¯å¦æ›´æ–°äº† propsï¼Ÿ

è¿™æ—¶å€™å°±éœ€è¦ **Vue Test Utils**ã€‚

```vue
<!-- components/Counter.vue -->
<template>
  <button @click="count++">Count is: {{ count }}</button>
</template>

<script setup>
import { ref } from 'vue'
const count = ref(0)
</script>
```

```javascript
// components/Counter.test.js
import { mount } from '@vue/test-utils'
import Counter from './Counter.vue'

test('increments value on click', async () => {
  const wrapper = mount(Counter)
  
  // æ–­è¨€åˆå§‹æ–‡æœ¬
  expect(wrapper.text()).toContain('Count is: 0')
  
  // æ¨¡æ‹Ÿç‚¹å‡»
  await wrapper.find('button').trigger('click')
  
  // æ–­è¨€æ›´æ–°åçš„æ–‡æœ¬
  expect(wrapper.text()).toContain('Count is: 1')
})
```

æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨äº† `mount` è€Œä¸æ˜¯ `shallowMount`ã€‚`mount` æ›´æ¥è¿‘çœŸå®æ¸²æŸ“ï¼Œ`shallowMount` æ›´é€‚åˆéš”ç¦»å­ç»„ä»¶ä¾èµ–ï¼Œå®é™…é¡¹ç›®ä¸­å¯æŒ‰æµ‹è¯•ç›®æ ‡é€‰æ‹©ã€‚

## 3. ç«¯åˆ°ç«¯æµ‹è¯• (E2E)ï¼šCypress / Playwright

å•å…ƒæµ‹è¯•å’Œç»„ä»¶æµ‹è¯•åªèƒ½ä¿è¯ä»£ç é€»è¾‘æ˜¯å¯¹çš„ï¼Œä½†ä¸èƒ½ä¿è¯åœ¨çœŸå®æµè§ˆå™¨ä¸­è·‘èµ·æ¥æ˜¯å¯¹çš„ã€‚

E2E æµ‹è¯•ä¼šæ¨¡æ‹ŸçœŸå®ç”¨æˆ·çš„æ“ä½œï¼šæ‰“å¼€æµè§ˆå™¨ -> è®¿é—®é¡µé¢ -> ç‚¹å‡»ç™»å½• -> è·³è½¬é¦–é¡µã€‚

### 3.1 Cypress å®æˆ˜

Cypress æ˜¯ç›®å‰æœ€æµè¡Œçš„ E2E æ¡†æ¶ä¹‹ä¸€ï¼Œå®ƒçš„ API éå¸¸è¯­ä¹‰åŒ–ã€‚

```javascript
// cypress/e2e/login.cy.js
describe('Login Flow', () => {
  it('successfully logs in', () => {
    cy.visit('/login')
    
    // å¡«å†™è¡¨å•
    cy.get('input[name=username]').type('testuser')
    cy.get('input[name=password]').type('password123')
    
    // ç‚¹å‡»æäº¤
    cy.get('button[type=submit]').click()
    
    // æ–­è¨€ URL è·³è½¬
    cy.url().should('include', '/dashboard')
    
    // æ–­è¨€é¡µé¢å†…å®¹
    cy.contains('Welcome, testuser')
  })
})
```

Cypress ä¼šè‡ªåŠ¨å¯åŠ¨ä¸€ä¸ªæµè§ˆå™¨çª—å£ï¼Œä½ å¯ä»¥çœ‹ç€å®ƒè‡ªåŠ¨æ‰§è¡Œæ¯ä¸€ä¸ªæ­¥éª¤ï¼Œå°±åƒæœ‰ä¸ªéšå½¢äººåœ¨æ“ä½œä¸€æ ·ã€‚

## 4. æ€»ç»“ï¼šæµ‹è¯•ç­–ç•¥

1.  **å·¥å…·å‡½æ•° & Composables**ï¼šå†™ **Vitest å•å…ƒæµ‹è¯•**ã€‚è¦†ç›–ç‡é«˜ï¼Œè¿è¡Œå¿«ï¼Œæ˜¯é‡æ„çš„åŸºçŸ³ã€‚
2.  **æ ¸å¿ƒä¸šåŠ¡ç»„ä»¶**ï¼šå†™ **Vue Test Utils ç»„ä»¶æµ‹è¯•**ã€‚å…³æ³¨äº¤äº’é€»è¾‘ï¼ˆç‚¹å‡»ã€è¾“å…¥ã€äº‹ä»¶ï¼‰ã€‚
3.  **å…³é”®ç”¨æˆ·è·¯å¾„**ï¼ˆç™»å½•ã€æ”¯ä»˜ã€ä¸‹å•ï¼‰ï¼šå†™ **Cypress E2E æµ‹è¯•**ã€‚ä¿è¯æ•´ä¸ªç³»ç»Ÿæµç¨‹é€šç•…ã€‚

**ä¸‹ä¸€ç¯‡é¢„å‘Š**ï¼š
åŸºç¡€å’Œåº”ç”¨å±‚é¢çš„å†…å®¹æˆ‘ä»¬å·²ç»è®²å®Œäº†ã€‚ä»ä¸‹ä¸€ç¯‡å¼€å§‹ï¼Œæˆ‘ä»¬å°†è¿›å…¥**Vue 3 çš„å†…æ ¸ä¸–ç•Œ**ã€‚ä½ æ˜¯å¦å¥½å¥‡ `reactive` åˆ°åº•æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ`track` å’Œ `trigger` æ˜¯å¦‚ä½•é…åˆå·¥ä½œçš„ï¼Ÿä¸‹ä¸€ç¯‡ã€Šæ·±å…¥å“åº”å¼åŸç† (ä¸Š)ã€‹å°†å¸¦ä½ æ‰‹å†™ä¸€ä¸ª mini-vueã€‚

---

> **è¿™é‡Œæ˜¯ã€ŠVue 3 å…¨æ™¯æ”»ç•¥ã€‹ç³»åˆ—æ•™ç¨‹ã€‚**
>
> å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ **ç‚¹èµã€åœ¨çœ‹ã€åˆ†äº«** æ”¯æŒä¸€ä¸‹ï¼
>
> ğŸ‘‡ **å…³æ³¨å…¬ä¼—å·ã€Œç§»åŠ¨APPå¼€å‘ã€ï¼Œå›å¤â€œVue3â€è·å–æœ¬ç³»åˆ—å®Œæ•´æ€ç»´å¯¼å›¾ä¸æºç ã€‚**

*(æ­¤å¤„æ’å…¥å…¬ä¼—å·åç‰‡)*
