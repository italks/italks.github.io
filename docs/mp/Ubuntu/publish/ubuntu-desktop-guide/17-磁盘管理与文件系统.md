# 17. 磁盘管理与文件系统

Linux 没有固定的 “C 盘 / D 盘”。它的逻辑是：所有存储设备最终都会挂到同一棵目录树上。理解这件事，会直接影响你后续的分区、挂载、备份和排障。

## 1. 核心目录结构

*   `/`: 根目录，一切的起点。
*   `/home`: 用户的家目录（存放文档、下载、桌面）。
*   `/etc`: 配置文件（Editable Text Configuration）。
*   `/var`: 经常变化的文件（日志、缓存、网站数据）。
*   `/bin` & `/usr/bin`: 可执行的命令。
*   `/mnt` & `/media`: 挂载点（U 盘、外接硬盘）。

如果你把 `/home` 单独分区：重装系统时可以尽量保留个人数据；但也意味着备份策略要更清晰（别把“分区”当成“备份”）。

## 2. 查看磁盘空间

### df (Disk Free)
查看磁盘分区使用情况。
```bash
df -h   # -h 表示 Human-readable (以 GB/MB 显示)
```

### du (Disk Usage)
查看文件或目录占用了多少空间。
```bash
du -sh FolderName   # 查看某个文件夹的总大小
du -h --max-depth=1 # 查看当前目录下各子文件夹的大小
```

## 3. 磁盘分区与挂载

在 Linux 中，插入硬盘不会自动变成 "E 盘"，你需要**挂载 (Mount)** 它。

### lsblk (List Block Devices)
列出所有存储设备与分区。
```bash
lsblk -f
```
你可能会看到 `sda` (第一块硬盘), `sdb` (第二块硬盘)。

### 挂载命令
```bash
sudo mount /dev/sdb1 /mnt/usb   # 把 sdb1 分区挂载到 /mnt/usb 目录
sudo umount /mnt/usb            # 卸载 (拔 U 盘前必须做！)
```

常见文件系统小结（你会经常遇到）：

- **ext4**：Linux 桌面最常见，稳
- **btrfs**：支持快照/压缩等特性（有些发行版默认）
- **NTFS**：Windows 分区常见；需要访问 Windows 数据时经常用到
- **exFAT**：U 盘/移动硬盘常见，跨平台兼容好

### 自动挂载 (/etc/fstab)
如果你想让硬盘开机自动挂载，需要编辑 `/etc/fstab` 文件。
**警告**：这个文件改错了会导致开机失败！建议新手使用图形化工具 `Disks` (GNOME Disks) 来设置自动挂载。

## 4. 磁盘清理

如果 `/` 目录满了，系统会罢工。
1.  **清理 APT 缓存**: `sudo apt clean`
2.  **清理旧内核**: `sudo apt autoremove`
3.  **清理日志**: `sudo journalctl --vacuum-time=1w` (只保留一周的日志)
4.  **图形化工具**: `BleachBit` (类似 CCleaner)，但在 Linux 上要小心使用，别误删了系统文件。

想快速找出“空间到底去哪了”，可以从家目录开始排：

```bash
du -h --max-depth=1 ~ | sort -h
```

## 5. LVM 简介

LVM (Logical Volume Manager) 允许你动态调整分区大小。如果你在安装时选择了 LVM，你可以轻松地把新买的硬盘空间"融合"到现有的根目录中，而不需要重装系统。
