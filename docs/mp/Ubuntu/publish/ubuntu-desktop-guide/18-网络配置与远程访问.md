# 18. 网络配置与远程访问

> **摘要**：搞定网络是系统管理的基础。本文介绍 `ip` 命令查看状态、`ping` 排查连通性，以及通过 Netplan 配置静态 IP 的方法。同时详解 SSH 服务的安装与使用，助你实现安全的远程登录与管理，打通 Linux 与其他设备的连接通道。

桌面用户最常遇到的网络问题其实很朴素：连不上 Wi‑Fi、DNS 抽风、局域网互传文件麻烦。服务器用户更关心：静态 IP、SSH、安全边界。下面按这两个视角来讲。

## 1. 查看网络状态

### ip 命令
老旧的 `ifconfig` 已经被淘汰，现在是 `ip` 的天下。
```bash
ip addr     # 查看 IP 地址
ip route    # 查看网关/路由表
```

### ping
测试网络连通性。
```bash
ping baidu.com
```

如果 ping 域名不通但 ping IP（比如 `1.1.1.1`）能通，通常是 DNS 问题。

## 2. 配置 IP 地址 (Netplan)

Ubuntu 使用 **Netplan** 来管理网络配置。配置文件通常在 `/etc/netplan/` 目录下（如 `01-netcfg.yaml`）。

**设置静态 IP 示例**:
```yaml
network:
  version: 2
  renderer: networkd
  ethernets:
    enp3s0:   # 网卡名称
      dhcp4: no
      addresses:
        - 192.168.1.100/24
      routes:
        - to: default
          via: 192.168.1.1
      nameservers:
        addresses: [8.8.8.8, 1.1.1.1]
```
修改后运行 `sudo netplan apply` 生效。
*桌面用户通常直接在 Settings -> Network 里配置即可，不需要碰这个文件。*

## 3. SSH 远程登录

SSH (Secure Shell) 是 Linux 远程管理的标准。

1.  **安装 SSH Server**:
    ```bash
    sudo apt install openssh-server
    ```
2.  **查看服务状态**:
    ```bash
    sudo systemctl status ssh
    ```
3.  **连接**:
    在另一台电脑上：
    ```bash
    ssh username@192.168.1.100
    ```

更推荐的做法是用密钥登录（配合第 13 章的 SSH Key 思路）：安全、也省得输入密码。只要你需要长期远程管理，这一步很值得做。

## 4. 文件传输 (SCP)

无需 FTP，SSH 自带文件传输功能。

*   **上传**:
    ```bash
    scp local_file.txt user@remote_ip:/home/user/
    ```
*   **下载**:
    ```bash
    scp user@remote_ip:/home/user/remote_file.txt .
    ```

## 5. 防火墙 (UFW)

Ubuntu 自带 UFW (Uncomplicated Firewall)，顾名思义，它很简单。

```bash
sudo ufw enable         # 开启防火墙
sudo ufw allow ssh      # 允许 SSH (22端口)
sudo ufw allow 80/tcp   # 允许 HTTP
sudo ufw status         # 查看状态
```
**注意**：在开启防火墙前，务必确保 `allow ssh`，否则你可能会把自己锁在服务器外面。

如果你只允许局域网访问 SSH，可以更细一点：

```bash
sudo ufw allow from 192.168.1.0/24 to any port 22 proto tcp
```
