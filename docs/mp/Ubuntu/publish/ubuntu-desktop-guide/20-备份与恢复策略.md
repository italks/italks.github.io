# 20. 备份与恢复策略

> **摘要**：数据安全重于泰山。本文构建全方位的备份策略：用 Timeshift 创建系统快照以防滚挂，用 Deja Dup 备份个人文档，用 Rsync 进行硬核同步。学会这些“后悔药”，让你在折腾系统或遇到意外时能从容应对，数据无忧。

数据无价。折腾系统（尤其是分区、驱动、`/etc` 配置）之前，备份不是“良好习惯”，而是“止损机制”。

这一章把备份分成两类：

- **系统级**：系统坏了能快速回到可用状态
- **数据级**：文件、项目、照片等真正重要的东西不丢

## 1. Timeshift：系统时光机

Timeshift 是 Linux 下最接近 macOS "时间机器" 的工具。它可以创建整个系统的快照，当你把系统搞崩了，可以一键还原。

### 安装与配置
1.  **安装**:
    ```bash
    sudo apt install timeshift
    ```
2.  **设置**:
    *   **Snapshot Type**: 选择 RSYNC (最通用)。
    *   **Snapshot Location**: 选择一个空间大的分区（最好是外接硬盘）。
    *   **Schedule**: 建议开启每天自动备份，保留最近 5 份。
    *   **Users**: 默认只备份系统文件 (`/` 和 `/root`)，**不备份**用户家目录 (`/home`)。这是为了防止还原系统时覆盖了你的个人文档。**建议保持默认**。

### 如何还原
*   **如果还能进系统**: 打开 Timeshift，选择一个快照，点击 Restore。
*   **如果进不去系统了**: 使用 Ubuntu 安装盘启动 Live 环境，安装 Timeshift，然后进行还原。

## 2. 个人数据备份 (Deja Dup)

系统文件用 Timeshift，个人文件 (`/home`) 用 **Deja Dup (Backups)**。
它是 Ubuntu 预装的备份工具。

*   **功能**: 支持加密、压缩、增量备份；支持备份到 Google Drive 或本地 NAS。
*   **恢复**: 右键点击文件 -> "Revert to Previous Version..."。

## 3. 手动备份神器：Rsync

如果你喜欢命令行，`rsync` 是地表最强的文件同步工具。

```bash
# 将 Documents 目录同步到外部硬盘
rsync -avh --delete /home/user/Documents/ /media/usb/backup/Documents/
```
*   `-a`: 归档模式（保留权限、时间等）。
*   `-v`: 显示过程。
*   `-h`: 人类可读格式。
*   `--delete`: 如果源目录删除了文件，目标目录也同步删除（保持完全一致）。

`--delete` 很强，但也很危险：路径写错就是“同步删除”。第一次跑建议先加 `-n` 预演：

```bash
rsync -avhn --delete /home/user/Documents/ /media/usb/backup/Documents/
```

## 4. 最佳实践策略

一个现实可执行的策略（偏保守，但不容易翻车）：

1.  **系统级**：Timeshift 每周 1 次，保留 3–5 份
2.  **数据级**：Deja Dup/Rsync 每天或每周，至少存两份（本地一份 + 远端/NAS/云一份）
3.  **代码级**：项目进 Git；重要的配置（比如 `~/.ssh/config`、dotfiles）也进 Git，但别把私钥、token 之类敏感内容提交进去
4.  **操作前**：改 `/etc` 配置先备份一份，比如 `cp file file.bak`，出问题随时回滚

最后再提醒一句：备份的关键不是“有没有备份”，而是“能不能恢复”。定期抽一次恢复演练，比把备份做得花里胡哨更重要。
